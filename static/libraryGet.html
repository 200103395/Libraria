<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC65D4aIoayQlkDFJJzBtqKVpIQHSEM2_4&libraries=places"></script>
    <style>
        #books {
            display: flex;
        }
        .book {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<h1 id="libraryName"></h1>
<h1 id="email"></h1>
<h1 id="address"></h1>
<h1 id="contactNumber"></h1>
<div id="settings"></div>

<div id="map" style="border: 1px; height: 400px; width: 400px;"></div>
<div id="books">

</div>
<script>
    function initMap() {
        // Initialize the map
        var placeCoordinates = {lat: lib.latitude, lng: lib.longitude};

        var map = new google.maps.Map(document.getElementById('map'), {
            center: placeCoordinates, // Initial coordinates (New York City)
            zoom: 12 // Initial zoom level
        });

        var marker = new google.maps.Marker({
            position: placeCoordinates,
            map: map,
            title: 'London' // Marker title (optional)
        });
    }
</script>
<script>
    // Function to display JSON data as list items
    function displayJsonData() {
        initMap();
        showSettings();
        console.log(lib);
        document.getElementById("libraryName").innerText = lib.libraryName;
        document.getElementById("email").innerText = lib.email;
        document.getElementById("address").innerText = lib.address;
        document.getElementById("contactNumber").innerText = lib.contactNumber;
    }
    function showSettings() {
        fetch('/getAuth')
            .then(response => response.json())
            .then(data => decide(data))
            .catch(error => console.error(error));
    }
    function decide(data) {
        console.log(data);
        if( data.hasOwnProperty('error') || data.hasOwnProperty('firstName')) {
            return;
        }
        let splts = window.location.href.split('/');
        let id = splts[splts.length - 1];
        if( id == data['id']) {
            console.log('creating stuff');
            let a = document.createElement('a');
            a.href = '/library/settings';
            let button = document.createElement('h2');
            button.innerText = 'Change Library Information';
            a.appendChild(button);
            document.getElementById('settings').appendChild(a);
        }
    }
    function showBooks(books) {
        let container = document.getElementById('books');
        container.innerHTML = '';
        books.forEach(jsonObject => {
            const div = document.createElement('div');
            div.className = 'book';
            const a = document.createElement('a');
            a.href = '/book/' + jsonObject['id'];
            a.style.textDecoration = 'none';
            a.style.color = 'inherit';
            Object.keys(jsonObject).forEach(key => {
                const paragraph = document.createElement('p');
                paragraph.textContent = `${key}: ${jsonObject[key]}`;
                div.appendChild(paragraph);
            });
            a.appendChild(div);
            container.appendChild(a);
        });
    }
    function fetchBooks() {
        fetch('/getBooksByLibrary/' + lib['id'])
            .then(response => response.json())
            .then(data => showBooks(data))
            .catch(error => console.error(error));
    }

    // Call the function when the page loads
    window.onload = function() {
        displayJsonData();
        fetchBooks();
        //TODO: CREATE A SEARCH OR FILTER FEATURE
    }
</script>


<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC65D4aIoayQlkDFJJzBtqKVpIQHSEM2_4&libraries=places"></script>
</body>
</html>